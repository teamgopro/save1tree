<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TEKA Trees ðŸŒ³</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #ecfdf5, #d1fae5);
      margin: 0;
      padding: 0;
      color: #065f46;
      display: flex;
      flex-direction: row;
      min-height: 100vh;
    }

    main {
      flex: 3;
      padding: 30px;
    }

    aside {
      flex: 1;
      background: rgba(255, 255, 255, 0.4);
      padding: 20px;
      border-left: 2px solid #a7f3d0;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #donateBtn {
      background: #10b981;
      color: white;
      padding: 10px 20px;
      border: none;
      font-weight: bold;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s;
    }

    #donateBtn:hover {
      background: #059669;
    }

    #counter, #clicks {
      font-size: 2rem;
      font-weight: bold;
      margin: 10px 0;
    }

    #plantForm {
      margin: 20px 0;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 400px;
    }

    input, button {
      padding: 10px;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #a7f3d0;
    }

    #plantBtn, #clickBtn {
      background: #34d399;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
    }

    #plantBtn:hover, #clickBtn:hover {
      background: #059669;
    }

    #progressBarOuter {
      background: #d1fae5;
      height: 20px;
      border-radius: 10px;
      overflow: hidden;
      margin: 20px 0;
      max-width: 400px;
    }

    #progressBar {
      height: 100%;
      background: #10b981;
      width: 0%;
      transition: width 0.5s ease;
    }

    ul#leaderboard {
      list-style: none;
      padding: 0;
      max-width: 400px;
    }

    ul#leaderboard li {
      background: #ecfdf5;
      margin-bottom: 5px;
      padding: 10px;
      border-radius: 8px;
    }

    .medal {
      font-weight: bold;
      margin-right: 5px;
    }

    .dedicationMsg {
      background: rgba(255, 255, 255, 0.7);
      border-radius: 12px;
      padding: 10px;
      animation: fadeInOut 10s ease-in-out;
    }

    @keyframes fadeInOut {
      0% { opacity: 0; transform: translateY(20px); }
      10%, 90% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-20px); }
    }
  </style>
</head>
<body>
  <main>
    <h1>
      TEKA Trees ðŸŒ³
      <button id="donateBtn">Donate</button>
    </h1>

    <div id="counter">ðŸŒ± 0 Trees Planted</div>
    <div id="clicks">ðŸ”¥ 0 Clicks to Support</div>

    <div id="progressBarOuter">
      <div id="progressBar"></div>
    </div>

    <form id="plantForm">
      <input type="text" id="nameInput" placeholder="Enter your name" />
      <input type="text" id="dedicationInput" placeholder="Dedication message (optional)" />
      <button id="plantBtn">ðŸŒ± Plant Tree</button>
      <button id="clickBtn" type="button">ðŸ”¥ Click to Support</button>
    </form>

    <h2>Leaderboard</h2>
    <ul id="leaderboard"></ul>
  </main>

  <aside id="dedicationsContainer">
    <h3>Latest Dedications</h3>
  </aside>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAP9sPhuV5aczilZipv6FQJ9aMoBOBhXXQ",
      authDomain: "save1tree-f116f.firebaseapp.com",
      databaseURL: "https://save1tree-f116f-default-rtdb.firebaseio.com",
      projectId: "save1tree-f116f",
      storageBucket: "save1tree-f116f.appspot.com",
      messagingSenderId: "823144374779",
      appId: "1:823144374779:web:54a54f23cef8638dea6b5e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const nameInput = document.getElementById("nameInput");
    const dedicationInput = document.getElementById("dedicationInput");
    const plantBtn = document.getElementById("plantBtn");
    const clickBtn = document.getElementById("clickBtn");
    const counter = document.getElementById("counter");
    const clicksEl = document.getElementById("clicks");
    const leaderboard = document.getElementById("leaderboard");
    const progressBar = document.getElementById("progressBar");
    const dedicationsContainer = document.getElementById("dedicationsContainer");

    const GLOBAL_GOAL = 100_000_000;
    let lastClickTime = 0;

    function updateProgressBar(count) {
      const percent = Math.min((count / GLOBAL_GOAL) * 100, 100);
      progressBar.style.width = `${percent}%`;
    }

    function getToday() {
      return new Date().toISOString().split("T")[0];
    }

    function updateLeaderboard(users) {
      leaderboard.innerHTML = '';
      const today = getToday();
      const list = Object.entries(users).map(([name, days]) => [name, days[today] || 0]);
      list.sort((a, b) => b[1] - a[1]);
      list.slice(0, 10).forEach(([name, count], i) => {
        const li = document.createElement("li");
        const medals = ["ðŸ¥‡", "ðŸ¥ˆ", "ðŸ¥‰"];
        li.innerHTML = `<span class="medal">${medals[i] || ''}</span>${name}: ${count} trees`;
        leaderboard.appendChild(li);
      });
    }

    function addDedication(name, message) {
      const div = document.createElement("div");
      div.className = "dedicationMsg";
      div.textContent = `${name}: â€œ${message}â€`;
      dedicationsContainer.appendChild(div);
      while (dedicationsContainer.childElementCount > 6) {
        dedicationsContainer.children[1].remove();
      }
    }

    function safeName(name) {
      return name.replace(/[.#$[\]]/g, "_");
    }

    plantBtn.addEventListener("click", e => {
      e.preventDefault();
      const name = nameInput.value.trim() || "Anonymous ðŸŒ±";
      const dedication = dedicationInput.value.trim();
      const today = getToday();

      db.ref(`treeCount`).transaction(n => (n || 0) + 1);
      db.ref(`users/${safeName(name)}/${today}`).transaction(n => (n || 0) + 1);
      if (dedication) {
        db.ref(`dedications/${today}`).push({ name, message: dedication });
      }
    });

    clickBtn.addEventListener("click", () => {
      const now = Date.now();
      if (now - lastClickTime < 5000) return;
      lastClickTime = now;
      db.ref("clicks").transaction(n => (n || 0) + 1);
    });

    db.ref("treeCount").on("value", snap => {
      const count = snap.val() || 0;
      counter.textContent = `ðŸŒ± ${count.toLocaleString()} Trees Planted`;
      updateProgressBar(count);
    });

    db.ref("clicks").on("value", snap => {
      const count = snap.val() || 0;
      clicksEl.textContent = `ðŸ”¥ ${count.toLocaleString()} Clicks to Support`;
    });

    db.ref("users").on("value", snap => {
      updateLeaderboard(snap.val() || {});
    });

    db.ref(`dedications/${getToday()}`).limitToLast(5).on("child_added", snap => {
      const { name, message } = snap.val();
      addDedication(name, message);
    });
  </script>
</body>
</html>
