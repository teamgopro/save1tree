<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TEKA Trees</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0fdf4;
      color: #065f46;
      display: flex;
      flex-direction: row;
      height: 100vh;
      overflow: hidden;
    }

    .main {
      flex: 2;
      padding: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-y: auto;
      background: #f0fdf4;
    }

    .dedication-panel {
      flex: 1;
      background: rgba(255 255 255 / 0.15);
      backdrop-filter: blur(12px);
      border-left: 2px solid rgba(16, 185, 129, 0.3);
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      height: 100vh;
      box-sizing: border-box;
      color: #064e3b;
      box-shadow: 0 8px 32px rgba(16, 185, 129, 0.2);
    }

    .dedication-panel h2 {
      margin-top: 0;
      font-size: 1.5rem;
      font-weight: 700;
      border-bottom: 2px solid #10b981;
      padding-bottom: 8px;
      margin-bottom: 15px;
      color: #047857;
      user-select: none;
    }

    #dedicationList {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: calc(100vh - 80px);
      overflow-y: hidden;
    }

    .dedication {
      background: rgba(255 255 255 / 0.3);
      border-radius: 14px;
      padding: 14px 18px;
      font-size: 0.95rem;
      line-height: 1.3;
      color: #064e3b;
      box-shadow: 0 4px 12px rgba(6, 95, 70, 0.15);
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.6s forwards;
      word-wrap: break-word;
      user-select: text;
    }

    .dedication strong {
      font-weight: 700;
      margin-right: 8px;
      color: #065f46;
    }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    #counter {
      font-size: 3rem;
      font-weight: bold;
    }

    #facts {
      margin: 20px 0;
      font-style: italic;
      text-align: center;
      max-width: 500px;
      color: #065f46cc;
    }

    #plantForm {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 100%;
      max-width: 400px;
      margin: 20px 0;
      position: relative;
    }

    #nameInput, #dedicationInput, #plantBtn {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #a7f3d0;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }

    #nameInput:focus, #dedicationInput:focus {
      border-color: #10b981;
      outline: none;
    }

    #plantBtn {
      background: #10b981;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s ease;
      border: none;
    }

    #plantBtn:hover {
      background: #059669;
    }

    #treeEmoji {
      font-size: 3rem;
      margin: 20px;
    }

    .tree-bounce {
      animation: bounce 0.5s ease;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    #leaderboard {
      list-style: none;
      padding: 0;
      max-width: 400px;
      width: 100%;
    }

    #leaderboard li {
      background: #d1fae5;
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    #errorMessage {
      color: #dc2626;
      font-size: 0.9rem;
      margin-top: 4px;
      font-weight: 600;
      user-select: none;
      display: none;
    }
  </style>
</head>
<body>
  <div class="main">
    <h1>TEKA Trees</h1>
    <div id="counter">0</div>
    <div id="facts"></div>

    <form id="plantForm" autocomplete="off">
      <input type="text" id="nameInput" placeholder="Enter your name" autocomplete="off" />
      <div id="errorMessage">Please enter your name to plant a tree.</div>
      <input type="text" id="dedicationInput" placeholder="Dedication (optional)" autocomplete="off" />
      <button type="submit" id="plantBtn">ðŸŒ± Plant Tree</button>
    </form>

    <div id="treeEmoji">ðŸŒ³</div>
    <h2>Leaderboard</h2>
    <ul id="leaderboard"></ul>
  </div>

  <div class="dedication-panel">
    <h2>ðŸŒ± Tree Dedications</h2>
    <div id="dedicationList"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAP9sPhuV5aczilZipv6FQJ9aMoBOBhXXQ",
      authDomain: "save1tree-f116f.firebaseapp.com",
      databaseURL: "https://save1tree-f116f-default-rtdb.firebaseio.com",
      projectId: "save1tree-f116f",
      storageBucket: "save1tree-f116f.appspot.com",
      messagingSenderId: "823144374779",
      appId: "1:823144374779:web:54a54f23cef8638dea6b5e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const counterEl = document.getElementById("counter");
    const treeEmoji = document.getElementById("treeEmoji");
    const leaderboardEl = document.getElementById("leaderboard");
    const dedicationList = document.getElementById("dedicationList");
    const nameInput = document.getElementById("nameInput");
    const errorMessage = document.getElementById("errorMessage");

    const userCooldowns = {};

    function getTodayKey() {
      return new Date().toISOString().split("T")[0];
    }

    function animateTree() {
      treeEmoji.classList.add("tree-bounce");
      setTimeout(() => treeEmoji.classList.remove("tree-bounce"), 500);
    }

    function updateLeaderboard(users) {
      leaderboardEl.innerHTML = "";
      const today = getTodayKey();
      const entries = Object.entries(users).map(([user, days]) => [user, days[today] || 0]);
      entries.sort((a, b) => b[1] - a[1]);
      entries.slice(0, 10).forEach(([user, count], i) => {
        const li = document.createElement("li");
        let medal = i === 0 ? "ðŸ¥‡ " : i === 1 ? "ðŸ¥ˆ " : i === 2 ? "ðŸ¥‰ " : "";
        li.textContent = `${medal}${user}: ${count} tree${count !== 1 ? "s" : ""}`;
        leaderboardEl.appendChild(li);
      });
    }

    function addDedication(user, message) {
      // Create dedication div with fade-in animation
      const div = document.createElement("div");
      div.className = "dedication";
      div.innerHTML = `<strong>${user}:</strong> ${message}`;
      dedicationList.appendChild(div);

      // Remove oldest dedication if more than 5
      while (dedicationList.children.length > 5) {
        dedicationList.removeChild(dedicationList.firstChild);
      }
    }

    // Show or hide error message
    function validateName() {
      if (nameInput.value.trim() === "") {
        errorMessage.style.display = "block";
        nameInput.style.borderColor = "#dc2626";
        return false;
      } else {
        errorMessage.style.display = "none";
        nameInput.style.borderColor = "#10b981";
        return true;
      }
    }

    nameInput.addEventListener("input", () => {
      validateName();
    });

    document.getElementById("plantForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const name = nameInput.value.trim();
      const dedication = document.getElementById("dedicationInput").value.trim();

      if (!validateName()) {
        nameInput.focus();
        return;
      }

      const now = Date.now();
      const lastPlant = userCooldowns[name] || 0;
      if (now - lastPlant < 5000) {
        alert("Please wait 5 seconds before planting again.");
        return;
      }
      userCooldowns[name] = now;

      const today = getTodayKey();
      db.ref(`treeCount/${today}`).transaction((n) => (n || 0) + 1);
      db.ref(`users/${name}/${today}`).transaction((n) => (n || 0) + 1);

      if (dedication) {
        db.ref(`dedications/${today}`).push({ user: name, message: dedication });
      }

      animateTree();
      e.target.reset();
    });

    // Initial leaderboard and live updates
    db.ref("users").on("value", (snap) => {
      updateLeaderboard(snap.val() || {});
    });

    // Update tree count
    db.ref(`treeCount/${getTodayKey()}`).on("value", (snap) => {
      counterEl.textContent = snap.val() || 0;
    });

    // Listen for new dedications (last 5)
    db.ref(`dedications/${getTodayKey()}`).limitToLast(5).on("child_added", (snap) => {
      const val = snap.val();
      addDedication(val.user, val.message);
    });

    const facts = [
      "Trees absorb harmful gases and give us clean oxygen.",
      "One tree can remove up to 48 pounds of CO2 per year.",
      "Urban forests can reduce city temperatures by up to 10Â°F.",
      "Trees are home to more than 80% of land-based species.",
      "Planting trees can reduce stress and improve mood.",
    ];

    let factIndex = 0;
    function rotateFacts() {
      document.getElementById("facts").textContent = facts[factIndex];
      factIndex = (factIndex + 1) % facts.length;
    }
    rotateFacts();
    setInterval(rotateFacts, 7000);
  </script>
</body>
</html>
