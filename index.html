<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TEKA Trees</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f0fdf4;
      color: #064e3b;
      text-align: center;
      padding: 2rem;
    }

    h1 {
      font-size: 2.5rem;
      color: #065f46;
    }

    #counter {
      font-size: 3rem;
      font-weight: bold;
      margin: 10px 0;
    }

    #facts {
      margin: 20px auto;
      font-style: italic;
      max-width: 500px;
      color: #065f46;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 400px;
      margin: 20px auto;
    }

    input, button {
      padding: 10px;
      border-radius: 8px;
      font-size: 1rem;
      border: 1px solid #a7f3d0;
    }

    button {
      background-color: #10b981;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background-color: #059669;
    }

    #treeEmoji {
      font-size: 3rem;
      margin: 20px 0;
      transition: transform 0.3s;
    }

    .tree-bounce {
      animation: bounce 0.5s ease;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    #leaderboard {
      margin-top: 30px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
      padding: 0;
      list-style: none;
    }

    #leaderboard li {
      background: #d1fae5;
      padding: 10px;
      border-radius: 10px;
      margin: 5px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .medal {
      margin-right: 10px;
    }

    .name {
      font-weight: bold;
    }

    .count {
      color: #065f46;
    }
  </style>
</head>
<body>
  <h1>TEKA Trees</h1>
  <div id="counter">0</div>
  <div id="facts">Loading fact...</div>

  <form id="plantForm">
    <input type="text" id="nameInput" placeholder="Your name" required />
    <input type="text" id="dedicationInput" placeholder="Dedication (optional)" />
    <button type="submit">ðŸŒ± Plant a Tree</button>
  </form>

  <div id="treeEmoji">ðŸŒ³</div>

  <h2>Leaderboard</h2>
  <ul id="leaderboard"></ul>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAP9sPhuV5aczilZipv6FQJ9aMoBOBhXXQ",
      authDomain: "save1tree-f116f.firebaseapp.com",
      databaseURL: "https://save1tree-f116f-default-rtdb.firebaseio.com",
      projectId: "save1tree-f116f",
      storageBucket: "save1tree-f116f.appspot.com",
      messagingSenderId: "823144374779",
      appId: "1:823144374779:web:54a54f23cef8638dea6b5e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const counterEl = document.getElementById("counter");
    const leaderboardEl = document.getElementById("leaderboard");
    const treeEmoji = document.getElementById("treeEmoji");

    function getTodayKey() {
      return new Date().toISOString().split("T")[0];
    }

    function animateTree() {
      treeEmoji.classList.add("tree-bounce");
      setTimeout(() => treeEmoji.classList.remove("tree-bounce"), 500);
    }

    document.getElementById("plantForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const name = document.getElementById("nameInput").value.trim();
      const dedication = document.getElementById("dedicationInput").value.trim();
      const today = getTodayKey();

      if (!name) return alert("Please enter your name.");

      db.ref(`treeCount/${today}`).transaction(n => (n || 0) + 1);
      db.ref(`users/${name}/${today}`).transaction(n => (n || 0) + 1);

      if (dedication) {
        db.ref(`dedications/${today}`).push({ user: name, message: dedication });
      }

      animateTree();
    });

    db.ref(`treeCount/${getTodayKey()}`).on("value", (snapshot) => {
      counterEl.textContent = snapshot.val() || 0;
    });

    db.ref("users").on("value", (snapshot) => {
      const users = snapshot.val() || {};
      const today = getTodayKey();
      const userData = Object.entries(users).map(([name, days]) => {
        return { name, count: days[today] || 0 };
      }).filter(u => u.count > 0);

      userData.sort((a, b) => b.count - a.count);

      leaderboardEl.innerHTML = "";
      userData.forEach((user, index) => {
        const li = document.createElement("li");
        const medal = ["ðŸ¥‡", "ðŸ¥ˆ", "ðŸ¥‰"][index] || "ðŸŒ¿";
        li.innerHTML = `
          <span class="medal">${medal}</span>
          <span class="name">${user.name}</span>
          <span class="count">ðŸŒ³ ${user.count}</span>
        `;
        leaderboardEl.appendChild(li);
      });
    });

    const facts = [
      "Trees absorb harmful gases and give us clean oxygen.",
      "One tree can remove up to 48 pounds of CO2 per year.",
      "Urban forests can reduce city temperatures by up to 10Â°F.",
      "Trees are home to more than 80% of land-based species.",
      "Planting trees can reduce stress and improve mood."
    ];
    let factIndex = 0;
    function rotateFacts() {
      document.getElementById("facts").textContent = facts[factIndex];
      factIndex = (factIndex + 1) % facts.length;
    }
    rotateFacts();
    setInterval(rotateFacts, 7000);
  </script>
</body>
</html>
