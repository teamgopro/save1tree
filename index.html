<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TEKA Trees</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f0fdf4;
      color: #065f46;
      display: flex;
      flex-direction: row;
      height: 100vh;
    }

    .main {
      flex: 2;
      padding: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-y: auto;
    }

    .dedication-panel {
      flex: 1;
      background: #ecfdf5;
      border-left: 2px solid #a7f3d0;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      height: 100vh;
      box-sizing: border-box;
    }

    .dedication-panel h2 {
      margin-top: 0;
      font-size: 1.5rem;
      color: #047857;
      font-weight: 700;
      border-bottom: 2px solid #10b981;
      padding-bottom: 8px;
      margin-bottom: 15px;
    }

    #dedicationList {
      display: flex;
      flex-direction: column-reverse; /* newest on top */
      gap: 10px;
    }

    .dedication {
      background: white;
      box-shadow: 0 2px 8px rgb(6 95 70 / 0.15);
      border-radius: 12px;
      padding: 12px 16px;
      font-size: 0.95rem;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.6s forwards;
      word-wrap: break-word;
      line-height: 1.3;
      color: #064e3b;
    }

    .dedication strong {
      font-weight: 700;
      margin-right: 6px;
      color: #065f46;
    }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    #counter {
      font-size: 3rem;
      font-weight: bold;
    }

    #facts {
      margin: 20px 0;
      font-style: italic;
      text-align: center;
      max-width: 500px;
    }

    #plantForm {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 100%;
      max-width: 400px;
      margin: 20px 0;
    }

    #nameInput, #dedicationInput, #plantBtn {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #a7f3d0;
      font-size: 1rem;
    }

    #plantBtn {
      background: #10b981;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    #plantBtn:hover {
      background: #059669;
    }

    #treeEmoji {
      font-size: 3rem;
      margin: 20px;
    }

    .tree-bounce {
      animation: bounce 0.5s ease;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    #leaderboard {
      list-style: none;
      padding: 0;
      max-width: 400px;
      width: 100%;
    }

    #leaderboard li {
      background: #d1fae5;
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div class="main">
    <h1>TEKA Trees</h1>
    <div id="counter">0</div>
    <div id="facts"></div>

    <form id="plantForm">
      <input type="text" id="nameInput" placeholder="Enter your name" required />
      <input type="text" id="dedicationInput" placeholder="Dedication (optional)" />
      <button type="submit" id="plantBtn">ðŸŒ± Plant Tree</button>
    </form>

    <div id="treeEmoji">ðŸŒ³</div>
    <h2>Leaderboard</h2>
    <ul id="leaderboard"></ul>
  </div>

  <div class="dedication-panel">
    <h2>ðŸŒ± Tree Dedications</h2>
    <div id="dedicationList"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAP9sPhuV5aczilZipv6FQJ9aMoBOBhXXQ",
      authDomain: "save1tree-f116f.firebaseapp.com",
      databaseURL: "https://save1tree-f116f-default-rtdb.firebaseio.com",
      projectId: "save1tree-f116f",
      storageBucket: "save1tree-f116f.appspot.com",
      messagingSenderId: "823144374779",
      appId: "1:823144374779:web:54a54f23cef8638dea6b5e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const counterEl = document.getElementById("counter");
    const treeEmoji = document.getElementById("treeEmoji");
    const leaderboardEl = document.getElementById("leaderboard");
    const dedicationList = document.getElementById("dedicationList");

    const userCooldowns = {};

    function getTodayKey() {
      return new Date().toISOString().split("T")[0];
    }

    function animateTree() {
      treeEmoji.classList.add("tree-bounce");
      setTimeout(() => treeEmoji.classList.remove("tree-bounce"), 500);
    }

    function updateLeaderboard(users) {
      leaderboardEl.innerHTML = "";
      const today = getTodayKey();
      const entries = Object.entries(users).map(([user, days]) => [user, days[today] || 0]);
      entries.sort((a, b) => b[1] - a[1]);
      entries.slice(0, 10).forEach(([user, count], i) => {
        const li = document.createElement("li");
        let medal = i === 0 ? "ðŸ¥‡ " : i === 1 ? "ðŸ¥ˆ " : i === 2 ? "ðŸ¥‰ " : "";
        li.textContent = `${medal}${user}: ${count} tree${count !== 1 ? "s" : ""}`;
        leaderboardEl.appendChild(li);
      });
    }

    function addDedication(user, message) {
      // Create dedication div with fade-in animation
      const div = document.createElement("div");
      div.className = "dedication";
      div.innerHTML = `<strong>${user}:</strong> ${message}`;
      dedicationList.prepend(div);

      // Remove oldest dedication if more than 5
      if (dedicationList.children.length > 5) {
        const lastChild = dedicationList.lastElementChild;
        // Fade out animation
        lastChild.style.transition = "opacity 0.6s ease";
        lastChild.style.opacity = "0";
        setTimeout(() => lastChild.remove(), 600);
      }
    }

    document.getElementById("plantForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const name = document.getElementById("nameInput").value.trim();
      const dedication = document.getElementById("dedicationInput").value.trim();
      const today = getTodayKey();

      if (!name) return alert("Please enter your name.");

      const now = Date.now();
      const last = userCooldowns[name] || 0;
      if (now - last < 5000) {
        alert("Please wait 5 seconds before planting another tree.");
        return;
      }

      db.ref(`treeCount/${today}`).transaction(n => (n || 0) + 1);
      db.ref(`users/${name}/${today}`).transaction(n => (n || 0) + 1);
      if (dedication) {
        db.ref(`dedications/${today}`).push({ user: name, message: dedication });
      }

      animateTree();
      userCooldowns[name] = now;

      // Clear dedication input after submit
      document.getElementById("dedicationInput").value = "";
    });

    db.ref("users").on("value", snap => {
      updateLeaderboard(snap.val() || {});
    });

    db.ref(`treeCount/${getTodayKey()}`).on("value", snap => {
      counterEl.textContent = snap.val() || 0;
    });

    // On new dedication, add to the list with animation
    db.ref(`dedications/${getTodayKey()}`).on("child_added", (snap) => {
      const { user, message } = snap.val();
      addDedication(user, message);
    });

    const facts = [
      "Trees absorb harmful gases and give us clean oxygen.",
      "One tree can remove up to 48 pounds of CO2 per year.",
      "Urban forests can reduce city temperatures by up to 10Â°F.",
      "Trees are home to more than 80% of land-based species.",
      "Planting trees can reduce stress and improve mood."
    ];
    let factIndex = 0;
    function rotateFacts() {
      document.getElementById("facts").textContent = facts[factIndex];
      factIndex = (factIndex + 1) % facts.length;
    }
    rotateFacts();
    setInterval(rotateFacts, 7000);
  </script>
</body>
</html>
